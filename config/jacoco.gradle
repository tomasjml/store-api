jacoco {
    toolVersion = "0.8.12" // Use the latest version of JaCoCo
}

jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
    finalizedBy jacocoTestCoverageVerification // Always check coverage limits
}

jacocoTestCoverageVerification {
    // Fail build if coverage drops below 90%
    // See https://docs.gradle.org/current/dsl/org.gradle.testing.jacoco.tasks.JacocoCoverageVerification.html
    violationRules {
        rule {
            enabled = true
            element = 'CLASS'
            excludes = [
                    'com.dialexa.storeapi.StoreApiApplication',
                    'com.dialexa.storeapi.dto.*',
                    'com.dialexa.storeapi.entity.*',
                    'com.dialexa.storeapi.repository.*',
                    'com.dialexa.storeapi.constants.*',
            ]

            limit {
                counter = 'INSTRUCTION'
                value = 'COVEREDRATIO'
                minimum = 0.90
            }
        }
    }
}

test {
    finalizedBy jacocoTestReport // Run JaCoCo after tests
}